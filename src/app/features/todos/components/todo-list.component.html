<div class="max-w-6xl mx-auto">
  <h2 class="text-3xl font-bold mb-6">Mes Todos</h2>

  <!-- Loading -->
  <div *ngIf="loading" class="text-center py-8">
    <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
    <p class="mt-2 text-gray-600">Chargement des todos...</p>
  </div>

  <!-- Contenu principal -->
  <div *ngIf="!loading">
    <!-- Formulaire d'ajout -->
    <div class="bg-white p-6 rounded-lg shadow-md mb-8">
      <h3 class="text-xl font-semibold mb-4">Ajouter une tâche</h3>
      <form (ngSubmit)="addTodo()" #todoForm="ngForm" class="space-y-4">
        <input
          type="text"
          [(ngModel)]="newTodo.title"
          name="title"
          placeholder="Titre de la tâche"
          class="w-full border p-2 rounded"
          required
        />
        <input
          type="text"
          [(ngModel)]="newTodo.description"
          name="description"
          placeholder="Description (optionnel)"
          class="w-full border p-2 rounded"
        />
        <div class="flex items-center gap-4">
          <select [(ngModel)]="newTodo.priority" name="priority" class="border p-2 rounded">
            <option value="low">Basse priorité</option>
            <option value="medium">Priorité moyenne</option>
            <option value="high">Haute priorité</option>
          </select>
          <button
            type="submit"
            [disabled]="!todoForm.form.valid || addingTodo"
            class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 disabled:opacity-50 flex items-center"
          >
            <span
              *ngIf="addingTodo"
              class="inline-block animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"
            ></span>
            {{ addingTodo ? 'Ajout en cours...' : 'Ajouter' }}
          </button>
        </div>
      </form>
    </div>

    <!-- Colonnes Kanban -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <!-- À faire -->
      <div class="bg-gray-50 rounded-lg p-4">
        <h3 class="text-lg font-semibold mb-4">
          À faire ({{ todoService.pendingTodos().length }})
        </h3>
        <div class="space-y-3">
          <div
            *ngFor="let todo of todoService.pendingTodos()"
            [appHighlight]="todo.priority === 'high' ? 'rgba(239,68,68,0.1)' : 'transparent'"
            [appHighlightDelay]="500"
            class="bg-white p-4 rounded-lg shadow-sm border-l-4 border-gray-400"
          >
            <div class="flex justify-between items-start">
              <h4 class="font-medium text-gray-900">{{ todo.title }}</h4>
              <span
                class="px-2 py-1 text-xs font-semibold rounded-full"
                [ngClass]="{
                  'bg-red-100 text-red-800': todo.priority === 'high',
                  'bg-yellow-100 text-yellow-800': todo.priority === 'medium',
                  'bg-green-100 text-green-800': todo.priority === 'low',
                }"
              >
                {{ todo.priority | priority }}
              </span>
            </div>
            <p *ngIf="todo.description" class="text-sm text-gray-600 mt-2">
              {{ todo.description }}
            </p>
            <div class="flex justify-between text-xs text-gray-500 mt-3">
              <span>Créé le {{ todo.createdAt | date: 'dd/MM/yyyy' }}</span>
              <button
                (click)="updateStatus(todo.id, 'in-progress')"
                class="text-blue-600 hover:underline"
              >
                Commencer
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- En cours -->
      <div class="bg-gray-50 rounded-lg p-4">
        <h3 class="text-lg font-semibold mb-4">
          En cours ({{ todoService.inProgressTodos().length }})
        </h3>
        <div class="space-y-3">
          <div
            *ngFor="let todo of todoService.inProgressTodos()"
            [appHighlight]="todo.priority === 'high' ? 'rgba(239,68,68,0.1)' : 'transparent'"
            [appHighlightDelay]="500"
            class="bg-white p-4 rounded-lg shadow-sm border-l-4 border-blue-400"
          >
            <div class="flex justify-between items-start">
              <h4 class="font-medium text-gray-900">{{ todo.title }}</h4>
              <span
                class="px-2 py-1 text-xs font-semibold rounded-full"
                [ngClass]="{
                  'bg-red-100 text-red-800': todo.priority === 'high',
                  'bg-yellow-100 text-yellow-800': todo.priority === 'medium',
                  'bg-green-100 text-green-800': todo.priority === 'low',
                }"
              >
                {{ todo.priority | priority }}
              </span>
            </div>
            <p *ngIf="todo.description" class="text-sm text-gray-600 mt-2">
              {{ todo.description }}
            </p>
            <div class="flex justify-between text-xs text-gray-500 mt-3">
              <span>Mis à jour le {{ todo.updatedAt | date: 'dd/MM/yyyy' }}</span>
              <button
                (click)="updateStatus(todo.id, 'done')"
                class="text-green-600 hover:underline"
              >
                Terminer
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Terminé -->
      <div class="bg-gray-50 rounded-lg p-4">
        <h3 class="text-lg font-semibold mb-4">
          Terminé ({{ todoService.completedTodos().length }})
        </h3>
        <div class="space-y-3">
          <div
            *ngFor="let todo of todoService.completedTodos()"
            [appHighlight]="todo.priority === 'high' ? 'rgba(34,197,94,0.1)' : 'transparent'"
            [appHighlightDelay]="500"
            class="bg-white p-4 rounded-lg shadow-sm border-l-4 border-green-400"
          >
            <div class="flex justify-between items-start">
              <h4 class="font-medium text-gray-900 line-through">{{ todo.title }}</h4>
              <span
                class="px-2 py-1 text-xs font-semibold rounded-full"
                [ngClass]="{
                  'bg-red-100 text-red-800': todo.priority === 'high',
                  'bg-yellow-100 text-yellow-800': todo.priority === 'medium',
                  'bg-green-100 text-green-800': todo.priority === 'low',
                }"
              >
                {{ todo.priority | priority }}
              </span>
            </div>
            <p *ngIf="todo.description" class="text-sm text-gray-600 mt-2">
              {{ todo.description }}
            </p>
            <div class="flex justify-between text-xs text-gray-500 mt-3">
              <span>Fini le {{ todo.updatedAt | date: 'dd/MM/yyyy' }}</span>
              <button (click)="deleteTodo(todo.id)" class="text-red-600 hover:underline">
                Supprimer
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
